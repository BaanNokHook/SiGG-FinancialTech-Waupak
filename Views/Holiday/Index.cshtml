@model GM.Data.View.Static.HolidayViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/MainLayout.cshtml";
    bool isCreate = IsCreate;
    bool isUpdate = IsUpdate;
    bool isDelete = IsDelete;
}
@using (Html.BeginForm("Index", "Holiday", FormMethod.Post, new { id = "main-form" }))
{
    <section class="working-content">
        <div class="container-fluid container-fixed">
            <!-- PageTitle -->

            <div class="row row-fixed">
                <div class="col-lg-12 col-fixed">
                    <div class="page-title">
                        <div class="breadcrumb-wrap">
                            <ol class="breadcrumb" id="NavBar">
                                @*<li>
                                    <a href="Home\Index">Home</a>
                                </li>
                                <li class="active">Static Process</li>
                                <li class="active">Static</li>
                                <li class="active">Holiday</li>*@
                            </ol>
                        </div>
                        <div class="title">
                            <h1>
                                Holiday
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content Zone -->
            <div class="row row-fixed">
                <div class="col-xs-12 col-fixed">
                    <div class="box-content search-filter">
                        <div class="box-header">
                            <div class="left-item">
                                <div class="title">
                                    <h3>Search Holiday</h3>
                                </div>
                            </div>
                        </div>
                        <div class="form-container form-horizontal">
                            <div class="row">
                                <div class="col-xs-12 form-wrapper-1100">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.FormSearch.cur, htmlAttributes: new { @class = "control-label col-xs-4 col-md-5 col-lg-4 focus" })
                                        <div class="col-xs-5 col-md-7 col-lg-8">
                                            <div class="dropdown" style="max-width: 250px;">
                                                <button class="btn btn-default dropdown-toggle" id="ddl_cur" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    @Html.SpanFor(model => model.FormSearch.cur, "Select...", new { @class = "selected-data" })
                                                    @Html.TextBoxFor(model => model.FormSearch.cur, htmlAttributes: new { @class = "selected-value hidden" })
                                                    @Html.TextBoxFor(model => model.FormSearch.cur, htmlAttributes: new { @class = "selected-data hidden" })
                                                    <span class="caret"></span>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <div class="search-dropdown-menu">
                                                        <input type="text" data-action="@Url.Action("FillCur", (string)this.ViewContext.RouteData.Values["controller"])" id="txt_cur" class="form-control" placeholder="Search..." aria-describedby="basic-addon1">
                                                        <i class="feather-icon icon-search"></i>
                                                    </div>
                                                    <hr>
                                                    <ul id="ul_cur"></ul>
                                                </div>
                                            </div>
                                            <!-- /btn-group -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Data Table(new) -->
                    <div class="box-outside no-padding">
                        <div class="header-row">
                            <div class="left-content">
                                <div class="data-list text-list">
                                    <table>
                                        <tbody>
                                            <tr>
                                                <th>Total Holiday</th>
                                                <td>@Model.FormSearch.TotalEventDays Days</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="right-content">
                            </div>
                        </div>
                    </div>
                    <div class="box-nav-tab">
                        <ul class="nav nav-tabs">
                            @Html.HiddenFor(model => model.FormSearch.Tap)
                            @if (@Model.FormCalendar.Tap)
                            {
                                <li role="presentation" class="active">
                                    <a data-toggle="tab" id="tapCalendar2" onclick="return CheckOnTap(this);" href="#holiday-calendar">
                                        Calendar (@Model.FormSearch.cur)
                                    </a>
                                </li>
                                <li role="presentation">
                                    <a data-toggle="tab" id="tapEvent1" onclick="return CheckOnTap(this);" href="#holiday-list">
                                        Schedule Table (@Model.FormSearch.cur)
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li role="presentation">
                                    <a data-toggle="tab" id="tapCalendar2" onclick="return CheckOnTap(this);" href="#holiday-calendar">
                                        Calendar (@Model.FormSearch.cur)
                                    </a>
                                </li>
                                <li role="presentation" class="active">
                                    <a data-toggle="tab" id="tapEvent2" onclick="return CheckOnTap(this);" href="#holiday-list">
                                        Schedule Table (@Model.FormSearch.cur)
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>
                    <div class="tab-content holiday-data">
                        @Html.HiddenFor(model => model.FormSearch.ModeCalendar)
                        @Html.HiddenFor(model => model.FormSearch.year)
                        <div id="holiday-calendar" class="@Model.FormSearch.ModeCalendar">
                            @Html.HiddenFor(model => model.FormCalendar.Tap)
                            <div class="group box-header-wrapper">
                                <div class="box-header">
                                    <div class="left-item">
                                        <div class="year-select">
                                            <button class="btn btn-default-no-bg btn-round prev" name="btnPrv1" onclick="ClickPrv()" type="submit">
                                                <i class="feather-icon icon-chevron-left"></i>
                                            </button>
                                            <div class="dropdown">
                                                <button class="btn btn-default-no-bg btn-round dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    @Html.HiddenFor(model => model.FormSearch.yearCalendar)
                                                    @Html.DisplayFor(model => model.FormSearch.yearCalendar)
                                                </button>
                                                <ul id="ul_year_calendar" class="dropdown-menu checkbox-menu">
                                                    @for (var i = Model.FormSearch.yearCalendar.AsInt() + 2; i > Model.FormSearch.yearCalendar.AsInt(); i--)
                                                    {
                                                        <li>
                                                            <a href="javascript:CallBackCalendar(@i)">@i</a>
                                                        </li>
                                                    }
                                                    <li>
                                                        <a href="javascript:CallBackCalendar(@Model.FormSearch.yearCalendar);">@Model.FormSearch.yearCalendar</a>
                                                    </li>
                                                    @for (var i = Model.FormSearch.yearCalendar.AsInt() - 1; i > Model.FormSearch.yearCalendar.AsInt() - 3; i--)
                                                    {
                                                        <li>
                                                            <a href="javascript:CallBackCalendar(@i)">@i</a>
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <button class="btn btn-round btn-default-no-bg next" name="btnNext1" onclick="ClickNext()" type="submit">
                                                <i class="feather-icon icon-chevron-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="right-item">
                                        <div class="add-data">
                                            <button class="btn btn-primary btn-round" type="button" name="btnAdd1" data-toggle="modal" form-mode="add" key="" onclick="GM.Holiday.Form(this)" @(!isCreate ? "disabled" : "")>
                                                + Add Holiday
                                                <span class="caret"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="calendar-wrapper">
                                <div class="row">
                                    @if (Model.FormCalendar != null)
                                    {
                                        foreach (var month in Model.FormCalendar.EventYear.Months)
                                        {
                                            <div class="col-xs-4 col-md-4 col-lg-3 calendar-month">
                                                <div class="calendar-table">
                                                    <table>

                                                        <thead>
                                                            <tr class="month">
                                                                <th colspan="7">@month.Name</th>
                                                            </tr>
                                                            <tr class="day">
                                                                <th>S</th>
                                                                <th>M</th>
                                                                <th>T</th>
                                                                <th>W</th>
                                                                <th>T</th>
                                                                <th>F</th>
                                                                <th>S</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var week in month.Weeks)
                                                            {
                                                                <tr>
                                                                    @foreach (var day in week.Days)
                                                                    {
                                                                        <td class="@day.Mode">
                                                                            @if (day.Day == "")
                                                                            {
                                                                                @:&nbsp;
                                                                            }
                                                                            else
                                                                            {
                                                                                @day.Day
                                                                            }
                                                                            <div class="webui-popover-content holiday-view">
                                                                                <div class="header clearfix">
                                                                                    <div class="left-content">
                                                                                        <h5 class="date">@day.Date</h5>
                                                                                    </div>
                                                                                    <div class="right-content">
                                                                                        @if (@day.Description == "")
                                                                                        {

                                                                                            <button class="btn btn-primary btn-round" data-toggle="modal" form-mode="add" key="@day.Key" onclick="GM.Holiday.Form(this)"  @(!isCreate? "disabled":"")>
                                                                                                <i class="feather-icon icon-plus"></i>
                                                                                            </button>
                                                                                        }
                                                                                    </div>
                                                                                </div>
                                                                                <div class="holiday-date">
                                                                                    @if (@day.Description == "")
                                                                                    {
                                                                                        <span class="no-holiday">No Holiday :(</span>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <ul>
                                                                                            <li>
                                                                                                <div class="text">
                                                                                                    <span>@day.Description</span>
                                                                                                </div>
                                                                                                <div class="action">
                                                                                                    
                                                                                                    <button class="btn btn-default btn-round" data-toggle="modal" form-mode="@(isUpdate? "edit":"view")" key="@day.Key" onclick="GM.Holiday.Form(this)">
                                                                                                        <i class="feather-icon icon-edit"></i>
                                                                                                    </button>
                                                                                                    <button class="btn btn-delete btn-round" data-toggle="modal" form-mode="delete" key="@day.Key" onclick="GM.Holiday.Form(this)" @(!isDelete? "disabled":"") >
                                                                                                        <i class="feather-icon icon-trash-2"></i>
                                                                                                    </button>
                                                                                                </div>
                                                                                            </li>
                                                                                        </ul>
                                                                                    }
                                                                                </div>
                                                                            </div>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        @Html.HiddenFor(model => model.FormSearch.ModeEvent)
                        <div id="holiday-list" class="@Model.FormSearch.ModeEvent">
                            @Html.HiddenFor(model => model.FormEvent.Tap)
                            <div class="group box-header-wrapper">
                                <div class="box-header">
                                    <div class="left-item">
                                        <div class="year-select">
                                            <button class="btn btn-default-no-bg btn-round prev" name="btnPrv2" onclick="ClickPrv()" type="submit">
                                                <i class="feather-icon icon-chevron-left"></i>
                                            </button>
                                            <div class="dropdown">
                                                <button class="btn btn-default-no-bg btn-round dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    @Html.HiddenFor(model => model.FormSearch.yearEvent)
                                                    @Html.DisplayFor(model => model.FormSearch.yearEvent)
                                                </button>
                                                <ul id="ul_year_calendar" class="dropdown-menu checkbox-menu">
                                                    @for (var i = Model.FormSearch.yearEvent.AsInt() + 2; i > Model.FormSearch.yearEvent.AsInt(); i--)
                                                    {
                                                        <li>
                                                            <a href="javascript:CallBackEvent(@i)">@i</a>
                                                        </li>
                                                    }
                                                    <li>
                                                        <a href="javascript:CallBackEvent(@Model.FormSearch.yearEvent);">@Model.FormSearch.yearEvent</a>
                                                    </li>
                                                    @for (var i = Model.FormSearch.yearEvent.AsInt() - 1; i > Model.FormSearch.yearEvent.AsInt() - 3; i--)
                                                    {
                                                        <li>
                                                            <a href="javascript:CallBackEvent(@i)">@i</a>
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <button class="btn btn-round btn-default-no-bg next" name="btnNext2" onclick="ClickNext()" type="submit">
                                                <i class="feather-icon icon-chevron-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="right-item">
                                        <div class="add-data">
                                            <button class="btn btn-primary btn-round" type="button" name="btnAdd2" data-toggle="modal" form-mode="add" key="" onclick="GM.Holiday.Form(this)" @(!isCreate ? "disabled" : "") >
                                                + Add Holiday
                                                <span class="caret"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="holiday-list-wrapper outer-table-wrapper">
                                @if (Model.FormEvent != null)
                                {
                                    if (Model.FormEvent.EventYear.Months.Count > 0)
                                    {
                                        <table class="holiday-list-table" cellspacing="0" style="width:100%">
                                            @foreach (var month in Model.FormEvent.EventYear.Months)
                                            {
                                                <thead>
                                                    <tr>
                                                        <th colspan="4">
                                                            @month.Name
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var day in month.Days)
                                                    {
                                                        <tr>
                                                            <td width="15%">@day.Date</td>
                                                            <td width="80%">@day.Description</td>
                                                            <td class="action" width="5%">
                                                                <button class="btn btn-default btn-round" type="button" name="EditEvent" data-toggle="modal" form-mode="@(isUpdate? "edit":"view")" key="@day.Key" onclick="GM.Holiday.Form(this)">
                                                                    <i class="feather-icon icon-edit"></i>
                                                                </button>
                                                                <button class="btn btn-delete btn-round" type="button" name="DeleteEvent" data-toggle="modal" form-mode="delete" key="@day.Key" onclick="GM.Holiday.Form(this)" @(!isDelete? "disabled":"") >
                                                                    <i class="feather-icon icon-trash-2"></i>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            }
                                        </table>
                                    }
                                    else
                                    {<h>No data available in table</h>}
                                }
                                else
                                {
                                     <h>No data available in table</h>
                                }

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

<!-- Add Local user - Right Modal -->
<div class="modal right fade" id="add-holiday" tabindex="-1" role="dialog" aria-labelledby="edit-modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">
                        <i class="feather-icon icon-x"></i>
                    </span>
                </button>
                <h4 class="modal-title" id="myModalLabel2">Add Holiday</h4>
            </div>
            <div class="modal-body group">
                @using (Html.BeginForm("Create", "Holiday", FormMethod.Post, new { @class = "one-col-form", id = "action-form" }))
                {
                    <div class="form-container form-horizontal">
                        <div class="row">
                            <div class="col-xs-12 form-wrapper-max">
                                @Html.HiddenFor(model => model.FormAction.cur)
                                <div class="form-group">
                                    <label id="holidayType" class="control-label col-xs-3">Holiday type</label>
                                    <div class="col-xs-9">
                                        <div class="radio-form">
                                            <div class="radio select-btn-radio select-btn-xs">
                                                <label id="radio1" class="radio-inline c-radio checked" onclick="Click1Day()">
                                                    @Html.RadioButtonFor(model => model.FormAction.HolidayType, "true", htmlAttributes: new { @class = "btn-radio", @type = "radio", @checked = "checked", @ischeck = "true" }) 1 Day
                                                </label>
                                                <label id="radio2" class="radio-inline c-radio" onclick="ClickLongHoliday()">
                                                    @Html.RadioButtonFor(model => model.FormAction.HolidayType, "false", htmlAttributes: new { @class = "btn-radio", @type = "radio", @ischeck = "false" }) Long Holiday
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="dateOne" class="form-group">
                                    @Html.LabelForRequired(model => model.FormAction.holiday_date, htmlAttributes: new { @class = "control-label col-xs-3" })
                                    <div class="col-xs-6">
                                        <div class="input-group date">
                                            @Html.EditDateFor(model => model.FormAction.holiday_date, new { @class = "form-control date-time-picker-weekend"})
                                            <span class="input-group-addon">
                                                <span class="feather-icon icon-calendar-weekend"></span>
                                            </span>
                                        </div>
                                        <span id="holiday_date_error" class="field-validation-error text-danger" data-valmsg-replace="true">
                                        </span>
                                    </div>
                                </div>
                                <div id="dateGroup1" class="form-group" hidden="hidden">
                                    @Html.LabelForRequired(model => model.FormAction.HolidayStart, htmlAttributes: new { @class = "control-label col-xs-3" })
                                    <div class="col-xs-6">
                                        <div class="input-group date">
                                            @Html.EditDateFor(model => model.FormAction.HolidayStart, new { @class = "form-control date-time-picker-weekend" })
                                            <span class="input-group-addon">
                                                <span class="feather-icon icon-calendar-weekend"></span>
                                            </span>
                                        </div>
                                        <span id="HolidayStart_error" class="field-validation-error text-danger" data-valmsg-replace="true">
                                        </span>
                                    </div>
                                </div>
                                <div id="dateGroup2" class="form-group" hidden="hidden">
                                    @Html.LabelForRequired(mode => Model.FormAction.HolidayEnd, htmlAttributes: new { @class = "control-label col-xs-3" })
                                    <div class="col-xs-6">
                                        <div class="input-group date">
                                            @Html.EditDateFor(model => model.FormAction.HolidayEnd, new { @class = "form-control date-time-picker-weekend" })
                                            <span class="input-group-addon">
                                                <span class="feather-icon icon-calendar-weekend"></span>
                                            </span>
                                        </div>
                                        <span id="HolidayEnd_error" class="field-validation-error text-danger" data-valmsg-replace="true">
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    @Html.LabelForRequired(mode => Model.FormAction.holiday_desc, htmlAttributes: new { @class = "control-label col-xs-3" })
                                    <div class="col-xs-9">
                                        @Html.EditorForValidate(model => model.FormAction.holiday_desc, new { htmlAttributes = new { @class = "form-control ", @rows = "5" } })
                                        <span id="holiday_desc_error" class="field-validation-error text-danger" data-valmsg-replace="true">
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <hr>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <div class="col-xs-offset-3 col-xs-9">
                                        <button type="submit" class="btn btn-primary btn-round btn-main">Save</button>
                                        <button type="reset" class="btn btn-default btn-round btn-main" data-dismiss="modal">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
        <!-- modal-content -->
    </div>
    <!-- modal-dialog -->
</div>

@section Styles {
    @Styles.Render("~/bundles/SweetAlertCss")
}

@section Scripts {
    @Scripts.Render("~/bundles/SweetAlert")
    <script>

        var isUpdate = "@isUpdate";
        var isDelete = "@isDelete";

        function CallBackCalendar(val) {
            if (document.getElementById("FormSearch_yearCalendar").value != val) {
                document.getElementById("FormSearch_yearCalendar").value = val;
                document.getElementById("FormSearch_yearEvent").value = val;
                document.getElementById("FormSearch_year").value = val;
                document.forms[0].submit();
            }
        }

        function CallBackEvent(val) {
            if (document.getElementById("FormSearch_yearEvent").value != val) {
                document.getElementById("FormSearch_yearCalendar").value = val;
                document.getElementById("FormSearch_yearEvent").value = val;
                document.getElementById("FormSearch_year").value = val;
                document.forms[0].submit();
            }
        }

        function ClickNext() {
            var val = document.getElementById("FormSearch_year").value;
            document.getElementById("FormSearch_yearCalendar").value = (parseInt(val) + parseInt(1)).toString();
            document.getElementById("FormSearch_yearEvent").value = (parseInt(val) + parseInt(1)).toString();
            document.getElementById("FormSearch_year").value = (parseInt(val) + parseInt(1)).toString();
        }

        function ClickPrv() {
            var val = document.getElementById("FormSearch_year").value;
            document.getElementById("FormSearch_yearCalendar").value = (parseInt(val) - parseInt(1)).toString();
            document.getElementById("FormSearch_yearEvent").value = (parseInt(val) - parseInt(1)).toString();
            document.getElementById("FormSearch_year").value = (parseInt(val) - parseInt(1)).toString();
        }


        function CheckOnTap(evt) {
            if (evt.id == "tapEvent1" || evt.id == "tapEvent2") {
                document.getElementById("FormEvent_Tap").value = true;
                document.getElementById("FormCalendar_Tap").value = false;
            } else
            {
                document.getElementById("FormCalendar_Tap").value = true;
                document.getElementById("FormEvent_Tap").value = false;
            }
        }

        function Click1Day() {
            var groupOne =  $("#dateOne");
            var groupGroup1 =  $("#dateGroup1");
            var groupGroup2 = $("#dateGroup2");
            groupOne.removeAttr("hidden");
            groupGroup1.attr("hidden", "hidden");
            groupGroup2.attr("hidden", "hidden");

            $('#FormAction_HolidayType').val(true);

            document.getElementById("FormAction_HolidayType").value = true;
            document.getElementById("FormAction_HolidayStart").value = "";
            document.getElementById("FormAction_HolidayEnd").value = "";
        }

        function ClickLongHoliday() {
            var groupOne = $("#dateOne");
            var groupGroup1 = $("#dateGroup1");
            var groupGroup2 = $("#dateGroup2");

            groupOne.attr("hidden", "hidden");
            groupGroup1.removeAttr("hidden");
            groupGroup2.removeAttr("hidden");

            $('#FormAction_HolidayType').val(false);

            document.getElementById("FormAction_HolidayType").value = false;
            document.getElementById("FormAction_holiday_date").value = "";
        }

        $(document).ready(function () {

            $('.focus :input').focus();


            $("#main-form").submit(function (e) {
                $('.focus :input').focus();
                $(":submit", this).attr("disabled", "disabled");
                setTimeout(function () {
                    document.forms[0].submit();
                }, 1000);
                if (!submit)
                    e.preventDefault();
            });

            $("#ul_cur").on("click", ".searchterm", function (event) {
                document.forms[0].submit();
            });

            $("#action-form").on('submit', function (e) {

                GM.Message.Clear();
                e.preventDefault() // prevent the form's normal submission

                var isValid = true;

                var FormAction_holiday_date = $("#FormAction_holiday_date");
                var FormAction_HolidayStart = $("#FormAction_HolidayStart");
                var FormAction_HolidayEnd = $("#FormAction_HolidayEnd");
                var FormAction_holiday_desc = $("#FormAction_holiday_desc");

                var FormAction_HolidayType = $('#FormAction_HolidayType');

                $("#holiday_date_error").text("");
                $("#HolidayStart_error").text("");
                $("#HolidayEnd_error").text("");
                $("#holiday_desc_error").text("");

                FormAction_holiday_date.removeClass("input-validation-error");
                FormAction_HolidayStart.removeClass("input-validation-error");
                FormAction_HolidayEnd.removeClass("input-validation-error");
                FormAction_holiday_desc.removeClass("input-validation-error");

                if (FormAction_holiday_desc.val().trim() == "") {
                    $("#holiday_desc_error").text("The Description field is required.");
                    FormAction_holiday_desc.addClass("input-validation-error");
                    isValid = false;
                }

                if (document.getElementById("FormAction_HolidayType").value == "true") {
                    if (FormAction_holiday_date.val().trim() == "") {
                        $("#holiday_date_error").text("The Holiday Date field is required.");
                        FormAction_holiday_date.addClass("input-validation-error");
                        isValid = false;
                    }
                } else
                {
                    if (FormAction_HolidayStart.val().trim() == "") {
                        $("#HolidayStart_error").text("The Holiday Date Start field is required.");
                        FormAction_HolidayStart.addClass("input-validation-error");
                        isValid = false;
                    }
                    if (FormAction_HolidayEnd.val().trim() == "") {
                        $("#HolidayEnd_error").text("The Holiday Date End field is required.");
                        FormAction_HolidayEnd.addClass("input-validation-error");
                        isValid = false;
                    }
                }

                if (isValid) {
                    var dataToPost = $(this).serialize()
                    var action = $(this).attr('action')
                    if (action != "notpost") {
                        GM.Mask('#add-holiday .modal-content');
                        $.post(action, dataToPost)

                            .done(function (response, status, jqxhr) {
                                // this is the "success" callback
                                GM.Unmask();
                                if (response.Success) {
                                    GM.Message.Success('.modal-body', response.Message);
                                    GM.Defer(function () {
                                        $('#add-holiday').modal('hide');
                                    }, 500);
                                    document.forms[0].submit();
                                }
                                else {
                                    GM.Message.Error('.modal-body', response.Message);
                                }
                            })

                            .fail(function (jqxhr, status, error) {
                            });
                    }
                }
            });

            $("#action-form").on('reset', function (e) {
                var radioyes = $("[id=FormAction_HolidayType][value=true]");
                var radiono = $("[id=FormAction_HolidayType][value=false]");
                radioyes.attr('ischeck', 'true');
                radioyes.prop('checked', true);
                radioyes.attr('checked', 'checked');

                radiono.removeAttr('checked');
                radiono.attr('ischeck', 'false');
                radiono.prop('checked', false);

                $("#dateOne").removeAttr("hidden");
                $("#dateGroup1").attr("hidden", "hidden");
                $("#dateGroup2").attr("hidden", "hidden");

                $("#radio1").removeAttr("class");
                $("#radio1").attr("class", "radio-inline c-radio checked");
                $("#radio2").removeAttr("class");
                $("#radio2").attr("class", "radio-inline c-radio");

                $('#FormAction_holiday_date').attr('readonly', false);
                $('#FormAction_holiday_desc').attr('readonly', false);

                $(".radio-form").removeAttr("hidden");
                $("#holidayType").removeAttr("hidden");
                GM.Message.Clear();

                var FormAction_holiday_date = $("#FormAction_holiday_date");
                var FormAction_HolidayStart = $('#FormAction_HolidayStart');
                var FormAction_HolidayEnd = $('#FormAction_HolidayEnd');
                var FormAction_holiday_desc = $('#FormAction_holiday_desc');

                $("#holiday_date_error").text("");
                $("#HolidayStart_error").text("");
                $("#HolidayEnd_error").text("");
                $("#holiday_desc_error").text("");

                FormAction_holiday_date.removeClass("input-validation-error");
                FormAction_HolidayStart.removeClass("input-validation-error");
                FormAction_HolidayEnd.removeClass("input-validation-error");
                FormAction_holiday_desc.removeClass("input-validation-error");
            });

            GM.Holiday = {};
            GM.Holiday.Form = function (btn) {
            var mode = $(btn).attr("form-mode");
                GM.Message.Clear();
                GM.Holiday.Form.Initial();
                if (mode){
                    var key = $(btn).attr("key");
                    switch (mode){
                        case "add":
                            $(".modal-title").text("Create @Html.DisplayString((string)this.ViewContext.RouteData.Values["controller"])");
                            $('#add-holiday').modal('show');
                            if (key != null)
                            {
                                document.getElementById("FormAction_holiday_date").value = key;
                            }

                            $("#action-form :submit").removeClass('btn-delete').addClass('btn-primary').text('Save');
                            $("#action-form").attr("action", "@Url.Action("Create", "Holiday")");
                            break;
                        case "edit":
                            GM.Holiday.Get({
                                id: key,
                                form: 'action-form',
                                handler: function (response, status, jqxhr) {
                                }
                            });

                            if (key != null)
                            {
                                document.getElementById("FormAction_holiday_date").value = key;
                            }

                            $("#dateOne").removeAttr("hidden");
                            $("#dateGroup1").attr("hidden", "hidden");
                            $("#dateGroup2").attr("hidden", "hidden");

                            $('#FormAction_holiday_date').attr('readonly', true);

                            $(".radio-form").attr("hidden", "hidden");
                            $("#holidayType").attr("hidden", "hidden");

                            $('#add-holiday').modal('show');
                            $("#action-form :submit").removeClass('btn-delete').addClass('btn-primary').text('Save');
                            
                            $(".modal-title").text("Edit @Html.DisplayString((string)this.ViewContext.RouteData.Values["controller"])");
                            $("#action-form").attr("action", "@Url.Action("Edit","Holiday")");
                            break;
                        case "delete":
                                GM.Holiday.Get({
                                    id: key,
                                    form: 'action-form',
                                    handler: function (response, status, jqxhr) {
                                    }
                                });
                                if (key != null) {
                                    document.getElementById("FormAction_holiday_date").value = key;
                            }

                            $("#dateOne").removeAttr("hidden");
                            $("#dateGroup1").attr("hidden", "hidden");
                            $("#dateGroup2").attr("hidden", "hidden");

                            $('#FormAction_holiday_date').attr('readonly', true);
                            $('#FormAction_holiday_desc').attr('readonly', true);

                            $(".radio-form").attr("hidden", "hidden");
                            $("#holidayType").attr("hidden", "hidden");

                            $('#add-holiday').modal('show');
                            $("#action-form :submit").removeClass('btn-primary').addClass('btn-delete').text('Delete');
                            $(".modal-title").text("Delete @Html.DisplayString((string)this.ViewContext.RouteData.Values["controller"])");
                            $("#action-form").attr("action", "@Url.Action("Delete", @Html.DisplayString((string)this.ViewContext.RouteData.Values["controller"]))");
                            break;
                        case "view":
                            GM.Holiday.Get({
                                id: key,
                                form: 'action-form',
                                handler: function (response, status, jqxhr) {
                                }
                            });
                            if (key != null) {
                                document.getElementById("FormAction_holiday_date").value = key;
                            }
                            $("#dateOne").removeAttr("hidden");
                            $("#dateGroup1").attr("hidden", "hidden");
                            $("#dateGroup2").attr("hidden", "hidden");

                            $('#FormAction_holiday_date').attr('readonly', true);
                            $('#FormAction_holiday_desc').attr('readonly', true);

                            $(".radio-form").attr("hidden", "hidden");
                            $("#holidayType").attr("hidden", "hidden");

                            $('#add-holiday').modal('show');
                            $("#action-form :submit").removeAttr("onclick");
                            $("#action-form :submit").attr('disabled', "disabled");
                            $("#action-form :submit").removeClass('btn-delete').addClass('btn-primary').text('Save');
                            $(".modal-title").text("View @Html.DisplayString((string)this.ViewContext.RouteData.Values["controller"])");
                            break;
                    }
                }
            };

            GM.Holiday.Get = function (op) {
                $.get("@Url.Action("Edit", (string)this.ViewContext.RouteData.Values["controller"])", { date: op.id })
                    .done(function (response, status, jqxhr) {
                    GM.Holiday.Form.DataBinding({ form: op.form, data: response });
                        $('#FormAction_HolidayType').val(true);
                        document.getElementById("FormAction_HolidayType").value = true;
                    op.handler(response)
                })
                .fail(function (jqxhr, status, error) {
                });
            };

            $("#NavBar").html($('#NavHoliday').val());
        });
    </script>
    @Scripts.Render("~/module/holiday")
    @Scripts.Render("~/module/validation")
}